<!---
USAGE NOTE:

You cannot directly open this in the browser as ES modules are not supported on file://
Instead cd to packages/frontend dir (this and no other dir!) and run a local HTTP server with python:

% cd packages/frontend
% python3 -m http.server 8000

Then open http://localhost:8000/bin/sample.html in your browser
-->
<html>
    <head>
        <meta charset="utf-8" />
        <title>Nango Github example page</title>
        <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons" />
        <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.indigo-pink.min.css" />
        <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
    </head>
    <style>
        .list-control {
            width: 130px;
        }

        .ist-radio {
            display: inline;
        }
    </style>
    <body>
        <noscript>JavaScript is required to proceed with the authentication.</noscript>
        <ul class="list-control mdl-list" style="list-style-type: none">
            <li class="mdl-list__item">
                <span class="mdl-list__item-primary-content" style="width: 100px">Local </span>
                <span class="mdl-list__item-secondary-action">
                    <label class="list-radio mdl-radio mdl-js-radio mdl-js-ripple-effect" for="list-option-1">
                        <input type="radio" id="list-option-1" class="mdl-radio__button" name="options" value="1" checked />
                    </label>
                </span>
            </li>
            <li class="mdl-list__item">
                <span class="mdl-list__item-primary-content">Cloud </span>
                <span class="mdl-list__item-secondary-action">
                    <label class="list-radio mdl-radio mdl-js-radio mdl-js-ripple-effect" for="list-option-2">
                        <input type="radio" id="list-option-2" class="mdl-radio__button" name="options" value="2" />
                    </label>
                </span>
            </li>
        </ul>
        <form action="#" id="server-url-container" style="display: none">
            <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label" style="margin-left: 20px">
                <input class="mdl-textfield__input" type="text" id="server-url" />
                <label class="mdl-textfield__label" for="sample3">Server URL</label>
            </div>
        </form>
        <button id="connect" class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored" style="margin: 10px">Connect to Github</button>
        <p id="server-url-error" style="display: none; margin-left: 10px; color: red">
            Invalid Server URL. It should match: https://nango-server-[INSTANCE-ID].onrender.com
        </p>

        <div style="margin: 10px">
            <p id="result"></p>
        </div>

        <script type="module">
            import Nango from 'https://unpkg.com/@nangohq/frontend/dist/index.js';

            var link = document.getElementById('connect');
            var localSelect = document.getElementById('list-option-1');
            var cloudSelect = document.getElementById('list-option-2');
            var serverUrlInput = document.getElementById('server-url');
            var serverUrlInputContainer = document.getElementById('server-url-container');
            var serverUrlInputError = document.getElementById('server-url-error');

            link.addEventListener(
                'click',
                () => {
                    var localHost = 'http://localhost:3003';
                    var serverUrl = localSelect.checked ? localHost : serverUrlInput.value;

                    if (serverUrl !== localHost) {
                        try {
                            new URL(serverUrl);
                        } catch (err) {
                            serverUrlInputError.style.display = 'block';
                            return;
                        }
                    }

                    var nango = new Nango(serverUrl);
                    nango
                        .auth('github-dev', '1')
                        .then((result) => {
                            var resultElement = document.getElementById('result');
                            resultElement.innerHTML = `SUCCESS: ${JSON.stringify(result)}`;
                        })
                        .catch((error) => {
                            console.log('Error');
                            var resultElement = document.getElementById('result');
                            resultElement.innerHTML = `ERROR: ${JSON.stringify(error)}`;
                        });
                },
                false
            );

            cloudSelect.addEventListener('change', () => {
                serverUrlInputError.style.display = 'none';
                serverUrlInputContainer.style.display = cloudSelect.checked ? 'block' : 'none';
            });

            localSelect.addEventListener('change', () => {
                serverUrlInputError.style.display = 'none';
                serverUrlInputContainer.style.display = cloudSelect.checked ? 'block' : 'none';
            });

            serverUrlInput.addEventListener('input', () => {
                serverUrlInputError.style.display = 'none';
            });
        </script>
    </body>
</html>
