"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[2842],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>h});var a=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=a.createContext({}),c=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},u=function(e){var t=c(e.components);return a.createElement(l.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),d=c(n),h=o,m=d["".concat(l,".").concat(h)]||d[h]||p[h]||r;return n?a.createElement(m,i(i({ref:t},u),{},{components:n})):a.createElement(m,i({ref:t},u))}));function h(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,i=new Array(r);i[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:o,i[1]=s;for(var c=2;c<r;c++)i[c]=n[c];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},6030:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>p,frontMatter:()=>r,metadata:()=>s,toc:()=>c});var a=n(7462),o=(n(7294),n(3905));const r={},i="Self-Hosting Instructions",s={unversionedId:"nango-deploy/oss-instructions",id:"nango-deploy/oss-instructions",title:"Self-Hosting Instructions",description:"When self-hosting Nango, there is some configuration you need to take care of.",source:"@site/docs/nango-deploy/oss-instructions.md",sourceDirName:"nango-deploy",slug:"/nango-deploy/oss-instructions",permalink:"/nango-deploy/oss-instructions",draft:!1,editUrl:"https://github.com/nangohq/nango/tree/master/docs/docs/nango-deploy/oss-instructions.md",tags:[],version:"current",frontMatter:{},sidebar:"nango",previous:{title:"Nango Self Hosted",permalink:"/category/deploy-nango-self-hosted"},next:{title:"Deploy Nango on your local machine",permalink:"/nango-deploy/local"}},l={},c=[{value:"Server URL, Callback URL &amp; Custom Domains",id:"custom-urls",level:2},{value:"Persistent storage",id:"persistent-storage",level:2},{value:"Securing your instance",id:"securing-your-instance",level:2},{value:"Securing the API",id:"securing-the-api",level:3},{value:"Securing the dashboard",id:"securing-the-dashboard",level:3},{value:"Encrypt sensitive data",id:"encrypt-sensitive-data",level:3},{value:"Restricting the creation of new connections",id:"restricting-the-creation-of-new-connections",level:3},{value:"Telemetry",id:"telemetry",level:2}],u={toc:c};function p(e){let{components:t,...n}=e;return(0,o.kt)("wrapper",(0,a.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"self-hosting-instructions"},"Self-Hosting Instructions"),(0,o.kt)("p",null,"When self-hosting Nango, there is some configuration you need to take care of."),(0,o.kt)("admonition",{type:"caution"},(0,o.kt)("p",{parentName:"admonition"},"Nango is a recent product and we are improving it fast."),(0,o.kt)("p",{parentName:"admonition"},"At this point you should expect frequent changes to Nango, some of them requiring manual intervention upon updating your instance (i.e. breaking changes). We will do our best to always document these changes and providing you with a path to mitigate them. If you do not want to deal with this constraint, we recommend that you use ",(0,o.kt)("a",{parentName:"p",href:"/cloud"},"Nango Cloud"),"."),(0,o.kt)("p",{parentName:"admonition"},"If you need help or have questions about self-hosting please feel free to reach out on our ",(0,o.kt)("a",{parentName:"p",href:"https://www.nango.dev/slack"},"Slack community"),".")),(0,o.kt)("h2",{id:"custom-urls"},"Server URL, Callback URL & Custom Domains"),(0,o.kt)("p",null,"Add server environment variables for the instance URL and port (in the ",(0,o.kt)("inlineCode",{parentName:"p"},".env")," file or directly on Heroku/Render):"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"NANGO_SERVER_URL=<INSTANCE-URL>\nSERVER_PORT=<PORT>\n")),(0,o.kt)("p",null,"The resulting callback URL for OAuth will be ",(0,o.kt)("inlineCode",{parentName:"p"},"<INSTANCE-URL>/oauth/callback"),"."),(0,o.kt)("admonition",{type:"info"},(0,o.kt)("p",{parentName:"admonition"},"Your can customize the callback URL by adding a ",(0,o.kt)("inlineCode",{parentName:"p"},"NANGO_CALLBACK_URL")," environment variable (in the ",(0,o.kt)("inlineCode",{parentName:"p"},".env")," file or directly on Heroku/Render).")),(0,o.kt)("admonition",{type:"info"},(0,o.kt)("p",{parentName:"admonition"},"If your are using a custom domain, you should change the ",(0,o.kt)("inlineCode",{parentName:"p"},"NANGO_SERVER_URL")," server environment variable accordingly (in the ",(0,o.kt)("inlineCode",{parentName:"p"},".env")," file or directly on Heroku/Render).")),(0,o.kt)("h2",{id:"persistent-storage"},"Persistent storage"),(0,o.kt)("p",null,"If deploying with Docker Compose (e.g. AWS, GCP, DO), the database is bundled in a docker container with transient storage. This means that updating the Docker image causes configs/credentials loss. This is a no-go for production."),(0,o.kt)("p",null,"Connect Nango to an external Postgres DB that lives outside the docker setup to mitigate this."),(0,o.kt)("p",null,"To do so, modify the default values of the following server env variables (in the ",(0,o.kt)("inlineCode",{parentName:"p"},".env")," file):"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"NANGO_DB_USER=<REPLACE>\nNANGO_DB_PASSWORD=<REPLACE>\nNANGO_DB_HOST=<REPLACE>\nNANGO_DB_PORT=<REPLACE>\nNANGO_DB_NAME=<REPLACE>\nNANGO_DB_SSL=true\nNANGO_DB_POOL_MIN=<PICK-INT-OR-SKIP>\nNANGO_DB_POOL_MAX=<PICK-INT-OR-SKIP>\n")),(0,o.kt)("admonition",{type:"tip"},(0,o.kt)("p",{parentName:"admonition"},"Deploying with Render or Heroku automatically generates a persistent database connected to your Nango instance."),(0,o.kt)("p",{parentName:"admonition"},"For Render, the environment variables above are automatically set for you. For Heroku, check out our Heroku docs page for specific instructions.")),(0,o.kt)("admonition",{type:"tip"},(0,o.kt)("p",{parentName:"admonition"},"If you are using a serverless database, you might want to tune NANGO_DB_POOL_MIN and NANGO_DB_POOL_MAX params.\nOtherwise, knex (ORM used in Nango) will be keep connections alive and exhaust your serverless CPU quota.")),(0,o.kt)("h2",{id:"securing-your-instance"},"Securing your instance"),(0,o.kt)("h3",{id:"securing-the-api"},"Securing the API"),(0,o.kt)("p",null,"You can secure your instance's API by adding the ",(0,o.kt)("inlineCode",{parentName:"p"},"NANGO_SECRET_KEY")," env variable (in the ",(0,o.kt)("inlineCode",{parentName:"p"},".env")," file or directly on Heroku/Render)."),(0,o.kt)("p",null,"This will require ",(0,o.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Basic_access_authentication"},"Basic Auth")," for all sensitive API requests, e.g.:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"curl '<INSTANCE-URL>/connection/<CONNECTION-ID>?provider_config_key=<CONFIG-KEY>' -u '<SECRET-KEY>:'\n")),(0,o.kt)("p",null,"\u2757\ufe0fNote the ",(0,o.kt)("inlineCode",{parentName:"p"},":")," character appended after the ",(0,o.kt)("inlineCode",{parentName:"p"},"<SECRET-KEY>"),"."),(0,o.kt)("p",null,"If you are using the Node SDK, when initializing the ",(0,o.kt)("inlineCode",{parentName:"p"},"Nango")," object, pass in the Secret key in the ",(0,o.kt)("inlineCode",{parentName:"p"},"secretKey")," parameter."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"import { Nango } from '@nangohq/node';\n\nlet nango = new Nango({ host: 'http://localhost:3003', secretKey: '<SECRET-KEY>' });\n")),(0,o.kt)("admonition",{type:"tip"},(0,o.kt)("p",{parentName:"admonition"},"The Frontend SDK does not need the Secret key to initiate OAuth flows.")),(0,o.kt)("h3",{id:"securing-the-dashboard"},"Securing the dashboard"),(0,o.kt)("p",null,"By default, the dashboard of your Nango instance is open to anybody who has access to your instance URL."),(0,o.kt)("p",null,"You can secure it with Basic Auth by setting the following environment variables and restarting the server:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"NANGO_DASHBOARD_USERNAME=<PICK-A-USERNAME>\nNANGO_DASHBOARD_PASSWORD=<PICK-A-PASSWORD>\n")),(0,o.kt)("h3",{id:"encrypt-sensitive-data"},"Encrypt sensitive data"),(0,o.kt)("p",null,"You can enforce encryption of sensitive data (tokens, secret key, app secret) using the AES-GCM encryption algorithm. To do so, set the following environment variable to a randomly generated 256-bit base64-encoded key:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"NANGO_ENCRYPTION_KEY=<ADD-BASE64-256BIT-KEY>\n")),(0,o.kt)("p",null,"Once you restart the Nango server, the encryption of the database will happen automatically. Please note that, at the current time, you cannot modify this encryption key once you have set it."),(0,o.kt)("h3",{id:"restricting-the-creation-of-new-connections"},"Restricting the creation of new connections"),(0,o.kt)("p",null,"By default, your front-end application can attempt to create a new connection using any provider config key and connection ID."),(0,o.kt)("p",null,"In some applications, you may wish to restrict this, for example:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"You may want to restrict the ability to create connections for a given provider config key based on the current user, if some users are permitted to create connections to that provider and others are not."),(0,o.kt)("li",{parentName:"ul"},"You may want to use your applications user ID as the connection ID, and need to ensure that application user is the only one that can create a new connection with that connection ID.")),(0,o.kt)("p",null,"Nango provides the ability for an application to restrict the creation of new connections by the use of HMAC digests. The HMAC feature is disabled by default."),(0,o.kt)("p",null,"Once the HMAC feature is enabled, the Nango server will require that a HMAC digest is provided for every attempt to create a new connection from your front-end application."),(0,o.kt)("p",null,"The HMAC digest is generated by your application using a specified algorithm and key, and the digest is over the combination of the provider config key and the connection ID."),(0,o.kt)("p",null,"The algorithm and key must be shared between your application and the Nango server, so that the Nango server can verify the HMAC digest is correct. If the Nango server determines that the HMAC digest is missing or is invalid, then the request to create the new connection will be rejected."),(0,o.kt)("p",null,"Your application should only generate the HMAC digest after performing all authentication and authorization checks to ensure that the request to create the new connection is permitted. Your application should also keep the specified key private, and not reveal it to your front-end application or your end-users."),(0,o.kt)("p",null,"To enable the HMAC feature on the Nango server, set the following environment variables and restart the server:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"NANGO_HMAC_ENABLED=true\nNANGO_HMAC_KEY=<PICK-A-KEY>\n")),(0,o.kt)("p",null,"Optionally, you change the algorithm from the default of ",(0,o.kt)("inlineCode",{parentName:"p"},"sha256")," by setting the following environment variable and restarting the server:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"NANGO_HMAC_ALGORITHM=sha384\n")),(0,o.kt)("p",null,"When the HMAC feature is enabled, your front-end applicaton must always pass in an HMAC digest as follows:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"nango.auth('<CONFIG-KEY>', '<CONNECTION-ID>', { hmac: '<HMAC-DIGEST>' });\n")),(0,o.kt)("p",null,"The HMAC digest can be generated by using the following code in your back-end application:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"import * as crypto from 'node:crypto';\n\n// TODO: execute authentication and authorization checks before generating the HMAC digest.\n\n// The default value for '<HMAC-ALGORITHM>' is 'sha256'.\n// The value of '<HMAC-KEY>' should match the HMAC key passed to the Nango server.\nconst hmac = crypto.createHmac('<HMAC-ALGORITHM>', '<HMAC-KEY>');\nhmac.update('<CONFIG-KEY>:<CONNECTION-ID>');\nconst digest = hmac.digest('hex');\n\n// TODO: return the value of `digest` to the front-end application to pass to `nango.auth`.\n")),(0,o.kt)("h2",{id:"telemetry"},"Telemetry"),(0,o.kt)("p",null,"We use telemetry to understand Nango's usage at a high-level and improve it over time."),(0,o.kt)("p",null,"Telemetry on self-hosted instances is very light by default. We only track core actions and do not track sensitive information."),(0,o.kt)("p",null,"You can disable telemetry by setting the env var ",(0,o.kt)("inlineCode",{parentName:"p"},"TELEMETRY=false")," (in the ",(0,o.kt)("inlineCode",{parentName:"p"},".env")," file or directly on Heroku/Render)."))}p.isMDXComponent=!0}}]);